<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyOGVgCr3F_uWzFrB-WC83lRQuNOxaNg-oE_7IvzsonBdBlZhFutEeXHID3h1iWPCY/exec';

    document.addEventListener('DOMContentLoaded', function () {
        const loginForm = document.getElementById('loginForm');
        const registrationForm = document.getElementById('registrationForm');
        const showRegister = document.getElementById('showRegister');
        const showLogin = document.getElementById('showLogin');

        showRegister.addEventListener('click', function (e) {
            e.preventDefault();
            loginForm.style.display = 'none';
            registrationForm.style.display = 'block';
        });

        showLogin.addEventListener('click', function (e) {
            e.preventDefault();
            registrationForm.style.display = 'none';
            loginForm.style.display = 'block';
        });

        const forms = document.querySelectorAll('form');
        forms.forEach(form => {
            form.addEventListener('submit', function (e) {
                e.preventDefault();

                // REGISTRATION
                if (form.closest('#registrationForm')) {
                    const password = document.getElementById('reg-password').value;
                    const confirmPassword = document.getElementById('confirm-password').value;

                    if (password !== confirmPassword) {
                        alert('Kata sandi tidak cocok!');
                        return;
                    }

                    const formData = new FormData(form);
                    const partnerData = {
                        company: formData.get('company'),
                        industry: formData.get('industry'),
                        address: formData.get('address'),
                        fullname: formData.get('fullname'),
                        position: formData.get('position'),
                        email: formData.get('reg-email'),
                        phone: formData.get('phone'),
                        password: password,
                        timestamp: new Date().toISOString()
                    };

                    fetch(scriptURL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(partnerData)
                    })
                        .then(res => res.json())
                        .then(data => {
                            if (data.status === 'success') {
                                alert('Pendaftaran berhasil! Sekarang Anda bisa login.');
                                showLogin.click(); // Kembali ke login
                            } else {
                                alert('Gagal menyimpan data: ' + data.message);
                            }
                        })
                        .catch(err => {
                            console.error('Error:', err);
                            alert('Gagal menyimpan data: ' + err.message);
                        });
                }

                // LOGIN
                else if (form.closest('#loginForm')) {
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;

                    fetch(`${scriptURL}?email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`)
                        .then(res => res.json())
                        .then(data => {
                            if (data.status === 'success') {
                                alert('Login berhasil! Mengarahkan ke dashboard...');
                                window.location.href = 'dashboard.html';
                            } else {
                                alert('Email atau password salah!');
                            }
                        })
                        .catch(error => {
                            console.error('Login error:', error);
                            alert('Gagal memverifikasi login, coba lagi nanti');
                        });
                }
            });
        });
    });
</script>
